(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cff885c2"],{"501d":function(t,a,e){"use strict";e.r(a);var o=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("Row",{staticClass:"main-row"},[e("Col",{staticStyle:{height:"100%"},attrs:{span:"6"}},[e("Card",{staticClass:"tree-card-body"},[e("p",{attrs:{slot:"title"},slot:"title"},[e("Icon",{attrs:{type:"ios-cube-outline"}}),t._v("\n       栏目树\n     ")],1),e("Tree",{attrs:{data:t.treeData,"load-data":t.loadTreeChildren},on:{"on-select-change":t.handleClickNode}})],1)],1),e("Col",{staticClass:"rightCol",attrs:{span:"18"}},[e("Card",{staticClass:"tree-card-body"},[e("p",{attrs:{slot:"title"},slot:"title"},[e("Icon",{attrs:{type:"ios-browsers-outline"}}),t._v("\n           文章列表"),t.columnName.length>0?[t._v(" - [栏目："+t._s(t.columnName)+"]")]:t._e()],2),e("div",{staticClass:"search-con search-con-top"},[e("Row",[e("Col",{attrs:{span:"16"}},[e("Input",{staticClass:"search-input",attrs:{clearable:"",placeholder:"输入关键字搜索"},model:{value:t.searchValue,callback:function(a){t.searchValue=a},expression:"searchValue"}}),e("Button",{staticClass:"search-btn",attrs:{type:"primary"},on:{click:t.loadTableData}},[e("Icon",{attrs:{type:"search"}}),t._v("  搜索")],1)],1),e("Col",{staticClass:"right-col",attrs:{span:"8"}},[e("Button",{attrs:{size:"large",icon:"ios-add-circle-outline",type:"success"},on:{click:t.handleNewArticle}},[t._v("新增")])],1)],1)],1),e("div",{staticClass:"mainDiv"},[e("Table",{ref:"tables",staticClass:"mainTable",attrs:{border:"",editable:"",searchable:"","search-place":"top",columns:t.tableColumns,data:t.tableData,loading:t.tableLoading}}),e("Page",{attrs:{total:t.totalElements,current:t.page,"page-size":t.size,"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.handlePageChange,"on-page-size-change":t.handlePageSizeChange}})],1)])],1),t.infoDialogVisible?e("div",{staticClass:"infoDialog"},[e("Card",{staticClass:"dialogCard"},[e("p",{attrs:{slot:"title"},slot:"title"},[e("Icon",{attrs:{type:"ios-document-outline"}}),t._v("\n               文章详情"),t.columnName.length>0?[t._v(" - [栏目："+t._s(t.columnName)+"]")]:t._e()],2),e("a",{attrs:{slot:"extra",href:"#"},on:{click:function(a){return a.preventDefault(),t.closeDialog.apply(null,arguments)}},slot:"extra"},[e("Icon",{attrs:{type:"ios-close"}}),t._v("\n               关闭\n           ")],1),e("Form",{ref:"dataForm",attrs:{model:t.dataForm,rules:t.dataFormRules,"label-position":"right","label-width":80}},[e("FormItem",{attrs:{label:"文章图片"}},[e("Upload",{ref:"upload",staticStyle:{width:"198px",height:"198px"},attrs:{"show-upload-list":!1,type:"drag","on-success":t.handleSuccess,format:["jpg","jpeg","png"],"max-size":2048,"on-format-error":t.handleFormatError,"on-exceeded-size":t.handleMaxSize,"before-upload":t.handleBeforeUpload,action:"/api/attachment/upload"}},[e("div",{staticStyle:{width:"198px",height:"198px","line-height":"198px"}},[e("Icon",{directives:[{name:"show",rawName:"v-show",value:0==t.dataForm.imgUrl.length,expression:"dataForm.imgUrl.length == 0"}],attrs:{type:"ios-camera",size:"60"}}),e("img",{staticStyle:{"max-width":"100%","max-height":"100%"},attrs:{src:t.dataForm.imgUrl}})],1)])],1),e("FormItem",{attrs:{label:"标题",prop:"title"}},[e("Input",{staticStyle:{width:"600px"},attrs:{placeholder:"请输入标题..."},model:{value:t.dataForm.title,callback:function(a){t.$set(t.dataForm,"title",a)},expression:"dataForm.title"}})],1),e("FormItem",{attrs:{label:"副标题",prop:"subTitle"}},[e("Input",{staticStyle:{width:"600px"},attrs:{placeholder:"请输入副标题..."},model:{value:t.dataForm.subTitle,callback:function(a){t.$set(t.dataForm,"subTitle",a)},expression:"dataForm.subTitle"}})],1),e("FormItem",{attrs:{label:"作者",prop:"author"}},[e("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入作者..."},model:{value:t.dataForm.author,callback:function(a){t.$set(t.dataForm,"author",a)},expression:"dataForm.author"}})],1),e("FormItem",{attrs:{label:"来源",prop:"source"}},[e("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入来源..."},model:{value:t.dataForm.source,callback:function(a){t.$set(t.dataForm,"source",a)},expression:"dataForm.source"}})],1),e("FormItem",{attrs:{label:"发布日期",prop:"pubDate"}},[e("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"date",placeholder:"请选择日期..."},on:{"on-change":t.selectPubDate},model:{value:t.dataForm.pubDate,callback:function(a){t.$set(t.dataForm,"pubDate",a)},expression:"dataForm.pubDate"}})],1),e("FormItem",{attrs:{label:"摘要",prop:"resume"}},[e("Input",{staticStyle:{width:"600px"},attrs:{placeholder:"请输入摘要...",type:"textarea",rows:4},model:{value:t.dataForm.resume,callback:function(a){t.$set(t.dataForm,"resume",a)},expression:"dataForm.resume"}})],1),e("FormItem",{attrs:{label:"内容",prop:"content"}},[e("editor",{ref:"editor",attrs:{value:t.dataForm.content,cache:!1},on:{"on-change":t.handleContentChange}})],1),e("FormItem",{attrs:{label:"连接地址",prop:"url"}},[e("Input",{staticStyle:{width:"600px"},attrs:{placeholder:"请输入连接地址..."},model:{value:t.dataForm.url,callback:function(a){t.$set(t.dataForm,"url",a)},expression:"dataForm.url"}})],1),e("FormItem",{attrs:{label:"排序值",prop:"orderValue"}},[e("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入排序值..."},model:{value:t.dataForm.orderValue,callback:function(a){t.$set(t.dataForm,"orderValue",a)},expression:"dataForm.orderValue"}})],1),e("div",{staticClass:"buttonBorder"},[e("Button",{staticClass:"dialogButton",attrs:{type:"primary"},on:{click:t.saveData}},[t._v(" 保 存 ")]),e("Button",{staticClass:"dialogButton",on:{click:t.closeDialog}},[t._v(" 关 闭 ")])],1)],1)],1)],1):t._e()],1)},r=[],l=(e("7f7f"),e("ac6a"),e("43c1")),i=e("e069"),n=e("a0f0"),s={components:{Editor:n["a"]},data:function(){var t=this;return{tableColumns:[{title:"标题",key:"title",tree:!0},{title:"作者",key:"author"},{title:"来源",key:"source"},{title:"发布日期",key:"pubDate"},{title:"操作",key:"action",width:150,align:"center",render:function(a,e){return a("div",[a("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.handleEdit(e.row)}}},"修改"),a("Button",{props:{type:"error",size:"small"},on:{click:function(){t.handleRemove(e.row)}}},"删除")])}}],infoDialogVisible:!1,dataForm:{id:null,columnId:null,iconId:null,imgUrl:"",title:"",subTitle:"",author:"",source:"",pubDate:"",resume:"",content:"",url:"",orderValue:"50",columnProperty:this.$config.columnProperty.COMMON},dataFormRules:{title:[{required:!0,message:"标题必须输入",trigger:"blur"}],content:[{required:!0,message:"内容必须输入",trigger:"change"}],orderValue:[{required:!0,message:"请输入排序值",trigger:"blur"}]},treeData:[],tableData:[],tableLoading:!1,columnId:null,columnName:"",searchValue:"",size:10,totalElements:0,totalPages:0,page:1}},mounted:function(){this.dataForm.columnProperty=this.$config.columnProperty.COMMON,this.loadData()},methods:{loadData:function(){var t=this;this.treeData=[],Object(l["g"])(this.dataForm.columnProperty).then((function(a){a.data._embedded.cmsColumns.forEach((function(a){t.treeData.push(t.convertToTreeNode(a))}))}))},loadTreeChildren:function(t,a){var e=this;Object(l["f"])(t.id).then((function(t){var o=[];t.data._embedded.cmsColumns.forEach((function(t){o.push(e.convertToTreeNode(t))})),a(o)}))},convertToTreeNode:function(t){var a=this,e={id:t.id,code:t.code,name:t.name,pid:t.pid,parentName:t.parentName,iconId:t.iconId,orderValue:t.orderValue,property:t.property,displayFlag:t.displayFlag,memo:t.memo,title:t.name,expand:!1,children:[],loading:!1};return t.children&&t.children.length>0&&t.children.forEach((function(t){e.children.push(a.convertToTreeNode(t))})),e},handleClickNode:function(t){if(t&&t.length>0){var a=t[0];this.columnId=a.id,this.columnName=a.name,this.loadTableData()}},loadTableData:function(){var t=this;this.tableLoading=!0;var a={title:this.searchValue.trim(),columnId:this.columnId,page:this.page-1,size:this.size,sort:"id,desc"};Object(l["d"])(a).then((function(a){t.tableData=a.data._embedded.cmsArticles,t.size=a.data.page.size,t.totalElements=a.data.page.totalElements,t.totalPages=a.data.page.totalPages,t.page=a.data.page.number+1,t.tableLoading=!1})).catch((function(a){console.log(a),t.tableLoading=!1}))},handlePageChange:function(t){this.page=t,this.loadTableData()},handlePageSizeChange:function(t){this.size=t,this.loadTableData()},handleNewArticle:function(){this.columnId?(this.handleClearForm(),this.infoDialogVisible=!0):this.$Message.info("请首先选择栏目")},handleEdit:function(t){this.dataForm.id=t.id,this.dataForm.columnId=t.columnId,this.dataForm.iconId=t.iconId,this.dataForm.imgUrl=t.iconId?"/api/attachment/get/"+t.iconId:"",this.dataForm.title=t.title,this.dataForm.subTitle=t.subTitle,this.dataForm.author=t.author,this.dataForm.source=t.source,this.dataForm.pubDate=t.pubDate,this.dataForm.resume=t.resume,this.dataForm.content=t.content,this.dataForm.url=t.url,this.dataForm.orderValue=t.orderValue+"",this.dataForm.columnProperty=this.$config.columnProperty.COMMON,this.infoDialogVisible=!0},handleRemove:function(t){var a=this;i["Modal"].confirm({title:"确认删除吗？",onOk:function(){Object(l["a"])(t.id).then((function(t){a.handleClearForm(),a.loadTableData(),a.$Message.info("删除成功")}))},onCancel:function(){}})},closeDialog:function(){this.infoDialogVisible=!1},handleSelectParentNode:function(t){if(t&&t.length>0){var a=t[0];if(this.validateParentId(a,this.dataForm.id))return this.dataForm.pid=a.id,this.dataForm.parentName=a.title,void this.closeParentDialog()}this.dataForm.pid=null,this.dataForm.parentName="",this.closeParentDialog()},validateParentId:function(t,a){if(t.id===a)return!1;if(t.children&&t.children.length>0)for(var e in t.children)if(!this.validateParentId(e,a))return!1;return!0},handleClearForm:function(){this.dataForm.id=null,this.dataForm.columnId=null,this.dataForm.iconId=null,this.dataForm.imgUrl="",this.dataForm.title="",this.dataForm.subTitle=null,this.dataForm.author="",this.dataForm.source="",this.dataForm.pubDate="",this.dataForm.resume="",this.dataForm.content="",this.dataForm.url="",this.dataForm.orderValue="50",this.dataForm.columnProperty=this.$config.columnProperty.COMMON},saveData:function(){var t=this;this.$refs["dataForm"].validate((function(a){a&&(t.dataForm.columnId=t.columnId,Object(l["h"])(t.dataForm).then((function(a){t.handleClearForm(),t.loadTableData(),t.closeDialog(),t.$Message.info("保存成功")})))}))},handleSuccess:function(t,a){t&&t.rows&&t.rows.length>0&&(this.dataForm.imgUrl="/api/attachment/get/"+t.rows[0].id,this.dataForm.iconId=t.rows[0].id)},handleFormatError:function(t){this.$Notice.warning({title:"文件格式不正确",desc:"选中文件 "+t.name+" 的格式错误, 请选择 jpg 或 png 文件."})},handleMaxSize:function(t){this.$Notice.warning({title:"超出文件大小限制",desc:"选中文件  "+t.name+" 太大, 不应该超过 2M."})},handleBeforeUpload:function(){var t=!0;return t},handleContentChange:function(t,a){this.dataForm.content=t},selectPubDate:function(t){this.dataForm.pubDate=new Date(t)}}},d=s,c=(e("ca55"),e("2877")),u=Object(c["a"])(d,o,r,!1,null,"7e26ef20",null);a["default"]=u.exports},"79ee":function(t,a,e){},ca55:function(t,a,e){"use strict";e("79ee")}}]);